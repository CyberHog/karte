<%= render "shared/errors", obj: @receipt %>

<table class="highlight">
  <tr>
    <th><%= form.label :payday %></th>
    <td><%= form.date_field :payday,
              start_year: 2000, end_year: Time.now.year + 1 %></td>
  </tr>
  <tbody id="receipt_table">
  <tr>
    <th><%= form.label :service %></th>
    <td><%= form.select :service, Menu.all.map(&:content_name), id: "receipt_service" %></td>
    <td>
      <a class="btn-floating btn-small waves-effect waves-light green lighten-1" onclick="addList(this);"><i class="material-icons">add</i></a>
      <a class="btn-floating btn-small waves-effect waves-light red lighten-1" onclick="removeList(this);"><i class="material-icons">remove</i></a>
    </td>
  </tr>
  <tr>
    <th><%= form.label :payment %></th>
      <%= javascript_tag do %>
        payment = <%= Menu.pluck(:price) %>;
      <% end %>
    <td><%= form.text_field :payment, id: "receipt_payment" %></td>
  </tr>
  <tr>
    <th><%= form.label :gained_point %></th>
      <%= javascript_tag do %>
        point = <%= Menu.pluck(:attached_point) %>
      <% end %>
    <td><%= form.text_field :gained_point, id: "receipt_point" %></td>
  </tr>
  <tr>
    <th><%= form.label :payment_method %></th>
    <td><%= form.select :payment_method, Receipt.payment_methods.keys %></td>
  </tr>
  </tbody>
</table>

<script>
// 行追加
function addList(obj) {
  // tbody要素に指定したIDを取得し、変数「tbody」に代入
  var tbody = document.getElementById("receipt_table");
  // objの親の親のノードを取得し（つまりtr要素）、変数「tr」に代入
  var tr = obj.parentNode.parentNode;
  // selectがあるtr（行）を複製し、変数「list」に代入
  var list = tbody.childNodes[1].cloneNode(true);
  //　複製したノード「list」を直後の兄弟ノードの上に挿入
  // （「tr」の下に挿入）
  tbody.insertBefore(list, tr.nextSibling);
}

// 行削除
function removeList(obj) {

  // tbody要素に指定したIDを取得し、変数「tbody」に代入
  var tbody = document.getElementById("receipt_table");
  // objの親の親のノードを取得し（つまりtr要素）、変数「tr」に代入
  var tr = obj.parentNode.parentNode;
  // 「tbody」の子ノード「tr」を削除
  tbody.removeChild(tr);
}
</script>

<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript">
// 価格の自動入力
$(function () {
    $('select').on('change', function () {
        var i = $("#receipt_service").prop("selectedIndex");
        $('#receipt_payment').val(payment[i]);
    });
});

// ポイントの自動入力
$(function () {
    $('select').on('change', function () {
        var x = $("#receipt_service").prop("selectedIndex");
        $('#receipt_point').val(point[x]);
    });
});
</script>
